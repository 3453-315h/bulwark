import { Entity, Column, PrimaryGeneratedColumn, ManyToOne, OneToMany } from 'typeorm';
import { Assessment } from './Assessment';
import { Length, IsUrl, IsIn, MaxLength, IsAlpha, IsBoolean, IsDecimal } from 'class-validator';
import { File } from './File';

@Entity()
export class Vulnerability {
  @PrimaryGeneratedColumn()
  id: number;
  @Column()
  @Length(1, 15)
  jiraId: string;
  @Column()
  @MaxLength(6)
  @IsAlpha()
  @IsIn(['Low', 'Medium', 'High'])
  impact: string;
  @Column()
  @MaxLength(6)
  @IsAlpha()
  @IsIn(['Low', 'Medium', 'High'])
  likelihood: string;
  @Column()
  @MaxLength(13)
  @IsAlpha()
  @IsIn(['Low', 'Medium', 'High', 'Critical', 'Informational'])
  risk: string;
  @Column()
  @IsAlpha()
  @IsIn(['Yes', 'No'])
  systemic: string;
  @Column()
  @IsDecimal()
  cvssScore: number;
  @Column()
  @IsUrl()
  cvssUrl: string;
  @Column()
  @IsIn(['Open', 'Resolved', 'On Hold'])
  status: string;
  @Column()
  @MaxLength(2000)
  description: string;
  @Column()
  @MaxLength(2000)
  detailedInfo: string;
  @Column()
  @MaxLength(2000)
  remediation: string;
  @Column()
  @MaxLength(100)
  name: string;
  @ManyToOne((type) => Assessment, (assessment) => assessment.id)
  assessment: Assessment;
  @OneToMany((type) => File, (file) => file.vulnerability)
  screenshots: File[];
}
